---
title: "GASã¨Zaimã‚’é€£æºã—ã¦æƒ…å ±ã‚’å–å¾—ã™ã‚‹"
emoji: "ğŸ’°"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["gas"]
published: false
---

# ã¯ã˜ã‚ã«

é…ã‚Œã°ã›ãªãŒã‚‰å®¶è¨ˆç°¿ç®¡ç†ã®è‡ªå‹•åŒ–ã‚’ã“ã‚Œã‹ã‚‰ã‚„ã£ã¦ã„ã“ã†ã¨æ€ã„ãŸã¡^[æ–°å¹´ã«ãªã‚‹ã¨ä½•ã‹æ–°ã—ã„ã“ã¨ã‚’ã—ãŸããªã‚Šã¾ã™ã­...ã€‚]ã€äºŒç•ªç…ã˜ã«ã‚‚ç¨‹ãŒã‚ã‚‹ GAS $\times$ Zaim API ã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚‹å®¶è¨ˆæƒ…å ±ã®è‡ªå‹•å–å¾—ã«å–ã‚Šçµ„ã‚“ã§ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚æ™®æ®µã¯ Zaim ã®è‡ªå‹•é€£æºã§ã‚¢ãƒ—ãƒªã‹ã‚‰ã¯ä¸ä¾¿ãªãæƒ…å ±ã‚’è¦‹ã‚Œã‚‹ã®ã§ã™ãŒã€ãã‚Œã‚’å°‘ã—åŠ å·¥ã—ãŸå½¢ã§ç®¡ç†ã—ã¦ã¿ãŸã„ã¨ã„ã†æ°—æŒã¡ã«ãªã£ãŸã®ã§è‡ªå‹•åŒ–ã«å–ã‚Šçµ„ã‚“ã§ã¿ã‚ˆã†ã¨æ€ã£ãŸæ¬¡ç¬¬ã§ã™ã€‚

# ç’°å¢ƒæ§‹ç¯‰ã®æ‰‹é †

GAS ã‚’å®Ÿè¡Œã—ãŸã¨ãã« Zaim ã«é€£æºã—ã¦ã„ã‚‹å£åº§æƒ…å ±ãªã©ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚’ç›®æ¨™ã¨ã—ã¦å–ã‚Šçµ„ã¿ã¾ã—ãŸã€‚å¤§ã¾ã‹ã«ã¯ä»¥ä¸‹ã®æ‰‹é †ã§æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

1. GAS ã«ã¦å–å¾—ç”¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹^[ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ä¸€æ—¦å®Œäº†ã•ã›ã€Zaim ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆæ™‚ã«ã€Œã‚µãƒ¼ãƒ“ã‚¹ã®URLã€ã«è»¢è¨˜ã™ã‚‹å¿…è¦ãŒã‚ã‚‹]
2. Zaim ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
3. GAS ã«ã¦å–å¾—ç”¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ --> æƒ…å ±ã®å–å¾—


# å„æ‰‹é †ã®è©³ç´°

## GASï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰

Google App Scriptï¼ˆGASï¼‰ã¯æ§˜ã€…ãªä½¿ç”¨ç”¨é€”ãŒå¯èƒ½ãª Google ãŒæä¾›ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚„ãã®ä»–ã‚µãƒ¼ãƒ“ã‚¹ãªã©ã¨é€£æºã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å°†æ¥çš„ã«ä»Šå›ä½œæˆã—ãŸä»•æ›ã‘ã‚’ LINE ãªã©ã‹ã‚‰å‚ç…§ã—ãŸã‹ã£ãŸãŸã‚^[LINE BOT ã¨ GAS ã®é€£æºæ–¹æ³•ã®æƒ…å ±ã‚‚å¤šãè¦‹å—ã‘ã‚‰ã‚ŒãŸã®ã§ã€ä½•ã‚‚è€ƒãˆãš GAS ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚]ã€Zaim ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã« GAS ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¨ã—ã¾ã—ãŸã€‚
æƒ…å ±ã®å–å¾—ã«ã¯ GAS ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚GAS ã«ãŠã‘ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ã¯ã€ä½œæˆã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚¢ãƒ—ãƒªã€ãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…ï¼‰ã‚’å¤–éƒ¨ã‹ã‚‰å®Ÿè¡Œã™ã‚‹ãŸã‚ã® URL ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚

ä»Šå›ã¯ã€[GitHubã®ã‚µãƒ³ãƒ—ãƒ«](https://github.com/googleworkspace/apps-script-oauth1/blob/main/samples/Twitter.gs)ã‚’å‚è€ƒã«ã—ã¦ GAS ã‚’ä½œæˆã—ã¾ã—ãŸã€‚Google github ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ Twitter ã®æƒ…å ±å–å¾—ç”¨ã‚µãƒ³ãƒ—ãƒ«ãªã®ã§ã€ã“ã¡ã‚‰ã‚’ Zaim ç”¨ã«ä¿®æ­£ã—ã¾ã™ã€‚

* å„ç¨®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ zaim ã®ã‚‚ã®ã«å¤‰æ›´
* `method` ã‚’ `get` ã«å¤‰æ›´

ãŒä»Šå›ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã«å½“ãŸã£ã¦å¿…è¦ãªä¿®æ­£ã§ã—ãŸã€‚ã¾ãŸã€`CONSUMER_KEY` ã¨ `CONSUMER_SECRET` ã¯ï¼ˆãƒ‹ãƒ¯ãƒˆãƒªåµãªã®ã§ã™ãŒï¼‰æ¬¡ã®å·¥ç¨‹ã® Zaim ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆæ™‚ã«ç”Ÿæˆã•ã‚Œã‚‹æƒ…å ±ã§ã™ã€‚ãã®ãŸã‚ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆã®ç”»é¢ã‚’ä½•åº¦ã‹è¡Œãæ¥ã™ã‚‹ã“ã¨ã¨ãªã‚Šã¾ã™ã€‚

```react
var CONSUMER_KEY = '.........';
var CONSUMER_SECRET = '.........';

/**
 * Authorizes and makes a request to the Twitter API.
 */
function run() {
  var service = getService_();
  if (service.hasAccess()) {
    var url = 'https://api.zaim.net/v2/home/money';
    var response = service.fetch(url, {
      method: 'get'
    });
    var result = JSON.parse(response.getContentText());
    Logger.log(JSON.stringify(result, null, 2));
  } else {
    var authorizationUrl = service.authorize();
    Logger.log('Open the following URL and re-run the script: %s',
        authorizationUrl);
  }
} 

/**
 * Reset the authorization state, so that it can be re-tested.
 */
function reset() {
  var service = getService_();
  service.reset();
}

/**
 * Configures the service.
 */
function getService_() {
  return OAuth1.createService('Twitter')
      // Set the endpoint URLs.
      .setAccessTokenUrl('https://api.zaim.net/v2/auth/access')
      .setRequestTokenUrl('https://api.zaim.net/v2/auth/request')
      .setAuthorizationUrl('https://auth.zaim.net/users/auth')

      // Set the consumer key and secret.
      .setConsumerKey(CONSUMER_KEY)
      .setConsumerSecret(CONSUMER_SECRET)

      // Set the name of the callback function in the script referenced
      // above that should be invoked to complete the OAuth flow.
      .setCallbackFunction('authCallback')
  
      // Using a cache will reduce the need to read from 
      // the property store and may increase performance.
      .setCache(CacheService.getUserCache())

      // Set the property store where authorized tokens should be persisted.
      .setPropertyStore(PropertiesService.getUserProperties());
}

/**
 * Handles the OAuth callback.
 */
function authCallback(request) {
  var service = getService_();
  var authorized = service.handleCallback(request);
  if (authorized) {
    return HtmlService.createHtmlOutput('Success!');
  } else {
    return HtmlService.createHtmlOutput('Denied');
  }
}
```

ã¾ãŸã€Zaim API ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã¯ã€OAuth1.0a èªè¨¼ãŒå¿…è¦ã¨ãªã‚‹ã®ã§ã™ãŒ^[OAuth2.0 ã¨ã¯å˜ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³é•ã„ã¨ã„ã†ã ã‘ã§ã¯ãªã„ã‚ˆã†ã§ã™ã€‚]ã€‚GAS ã®ãŸã‚ã® OAuth1 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦

- https://github.com/googleworkspace/apps-script-oauth1

ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã€README ã«å¾“ã£ã¦ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è¡Œã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/ce6537ee6385-20240105.png)
*OAuth1 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è¿½åŠ *



ä»¥ä¸Šã®è¨­å®šãŒçµ‚ã‚ã£ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å³ä¸Šã®ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚’æŠ¼ã—ã¾ã™ã€‚ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¸æŠã€ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ã€Œå…¨å“¡ã€ã‚’é¸æŠã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æŠ¼ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/cece22a74f7e-20240105.png)







## Zaim

ã“ã“2å¹´ã»ã©ãšã£ã¨ãŠä¸–è©±ã«ãªã£ã¦ã„ã‚‹å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒªã§^[æœ‰æ–™ä¼šå“¡ã«ãªã‚Šã¾ã—ãŸ]ã€UI ãŒä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚ˆã‚Šã‚‚è‡ªåˆ†å¥½ã¿ã ã£ãŸã‚Šã—ã¾ã™ã€‚


### æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 

Zaim ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- [Zaim Developer](https://dev.zaim.net/home)

ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã€Œæ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã€ã‚’é¸æŠå¾Œã€å„æƒ…å ±ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ã“ã®ã¨ãã€ã‚µãƒ¼ãƒ“ã‚¹ç¨®ã¨ã‚µãƒ¼ãƒ“ã‚¹ã®URLã¯ä»¥ä¸‹ã«ç¤ºã—ãŸé€šã‚Šã«è¨­å®šã—ãªã„ã¨ã†ã¾ãå‹•ä½œã—ã¾ã›ã‚“ã§ã—ãŸã®ã§ã”æ³¨æ„ãã ã•ã„ã€‚

- åç§°ï¼šä»»æ„
- ã‚µãƒ¼ãƒ“ã‚¹ç¨®ï¼šãƒ–ãƒ©ã‚¦ã‚¶ã‚¢ãƒ—ãƒª
- æ¦‚è¦ï¼šä»»æ„
- çµ„ç¹”ï¼šä»»æ„
- ã‚µãƒ¼ãƒ“ã‚¹ã®URLï¼šGASã®ãƒ‡ãƒ—ãƒ­ã‚¤URL
- ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ï¼šä»»æ„
- ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒï¼šä»»æ„

![](https://storage.googleapis.com/zenn-user-upload/860ceec32f14-20240105.png)


## GASï¼ˆå®Ÿè¡Œï¼‰

GASã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¨Zaim ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆãŒçµ‚ã‚ã‚Œã°ã€ã„ã‚ˆã„ã‚ˆ GAS ã‚’å®Ÿè¡Œã—ã¦æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

* å®Ÿè¡Œã™ã‚‹é–¢æ•°ã¨ã—ã¦ã€Œrunã€ã‚’é¸æŠã€å®Ÿè¡Œ

![](https://storage.googleapis.com/zenn-user-upload/6a8942b722c5-20240105.png)

* ã™ã‚‹ã¨å®Ÿè¡Œãƒ­ã‚°ã«ã€ŒOpen the following URL and re-run the script: https://....ã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹ã®ã§ã‚³ãƒ”ãƒ¼ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ --> ã€Œãƒ­ã‚°ã‚¤ãƒ³ã—ã¦è¨±å¯ã€ã‚’å®Ÿè¡Œ
* 

![](https://storage.googleapis.com/zenn-user-upload/5d5898a427f5-20240105.png)

![](https://storage.googleapis.com/zenn-user-upload/14f2e0f2282b-20240105.png)

![](https://storage.googleapis.com/zenn-user-upload/44eee2b19e31-20240105.png)

* èªè¨¼ã•ã‚Œã‚‹ã®ã§ã€å†åº¦ GAS ã®ç”»é¢ã«æˆ»ã‚Šã€ã€Œrunã€ã‚’å®Ÿè¡Œã™ã‚‹ã¨æƒ…å ±ãŒå–å¾—ã§ãã¾ã™


# æ„Ÿæƒ³

ä»¥ä¸Šã§ Zaim ã¨ GAS ã‚’é€£æºã—ã¦æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ããŸã®ã§ã€ã“ã®ä¸‹åœ°ã‚’å…ƒã« LINE ã¸ã®é€£æºã‚„å„ç¨®æƒ…å ±æ•´å½¢ãªã©ã«å–ã‚Šçµ„ã‚“ã§ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# å‚è€ƒæƒ…å ±

- [GASã‹ã‚‰Zaim APIã‚’åˆ©ç”¨ã™ã‚‹](https://qiita.com/shutosg/items/6845057432bca551024b)